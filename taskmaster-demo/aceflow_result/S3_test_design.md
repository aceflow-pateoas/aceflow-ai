# S3 æµ‹è¯•ç”¨ä¾‹è®¾è®¡ - taskmaster-demo

**é¡¹ç›®**: taskmaster-demo
**é˜¶æ®µ**: S3_test_design
**åˆ›å»ºæ—¶é—´**: 2025-08-17 15:32:29
**åŸºäº**: S1ç”¨æˆ·æ•…äº‹ + S2ä»»åŠ¡åˆ†è§£

---

## ğŸ“‹ æµ‹è¯•ç­–ç•¥æ¦‚è¿°

åŸºäºTaskMasteré¡¹ç›®çš„æ ¸å¿ƒéœ€æ±‚ï¼Œæµ‹è¯•ç­–ç•¥é‡ç‚¹å…³æ³¨ï¼š
- **æ•°æ®éš”ç¦»å®‰å…¨æ€§**: ç¡®ä¿ç”¨æˆ·æ•°æ®å®Œå…¨éš”ç¦»
- **åŠŸèƒ½å®Œæ•´æ€§**: éªŒè¯æ‰€æœ‰ç”¨æˆ·æ•…äº‹çš„å®ç°
- **æ€§èƒ½è¦æ±‚**: æ»¡è¶³5-50ç”¨æˆ·å¹¶å‘è®¿é—®
- **ç”¨æˆ·ä½“éªŒ**: ç•Œé¢å‹å¥½æ€§å’Œå“åº”é€Ÿåº¦

## ğŸ¯ æµ‹è¯•åˆ†å±‚æ¶æ„

### 1. å•å…ƒæµ‹è¯• (Unit Tests)
- **è¦†ç›–ç‡ç›®æ ‡**: â‰¥ 80%
- **æµ‹è¯•æ¡†æ¶**: pytest (åç«¯) + Jest (å‰ç«¯)
- **é‡ç‚¹**: ä¸šåŠ¡é€»è¾‘ã€æ•°æ®éªŒè¯ã€å·¥å…·å‡½æ•°

### 2. é›†æˆæµ‹è¯• (Integration Tests)
- **APIæµ‹è¯•**: FastAPIæ¥å£æµ‹è¯•
- **æ•°æ®åº“æµ‹è¯•**: DuckDBæ“ä½œæµ‹è¯•
- **ç»„ä»¶é›†æˆ**: å‰åç«¯äº¤äº’æµ‹è¯•

### 3. ç«¯åˆ°ç«¯æµ‹è¯• (E2E Tests)
- **ç”¨æˆ·æµç¨‹**: å®Œæ•´çš„ç”¨æˆ·æ“ä½œæµç¨‹
- **æµè§ˆå™¨æµ‹è¯•**: Playwright/Cypress
- **è·¨æµè§ˆå™¨**: Chrome, Firefox, Safari

### 4. æ€§èƒ½æµ‹è¯• (Performance Tests)
- **è´Ÿè½½æµ‹è¯•**: å¹¶å‘ç”¨æˆ·è®¿é—®
- **å‹åŠ›æµ‹è¯•**: ç³»ç»Ÿæé™æµ‹è¯•
- **å“åº”æ—¶é—´**: APIå“åº”æ—¶é—´ç›‘æ§

## ğŸ”’ å®‰å…¨æµ‹è¯•ç”¨ä¾‹

### SEC-001: ç”¨æˆ·æ•°æ®éš”ç¦»æµ‹è¯•
**æµ‹è¯•ç›®æ ‡**: éªŒè¯ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®

**æµ‹è¯•æ­¥éª¤**:
1. åˆ›å»ºç”¨æˆ·Aå’Œç”¨æˆ·B
2. ç”¨æˆ·Aåˆ›å»ºä»»åŠ¡T1
3. ç”¨æˆ·Bå°è¯•è®¿é—®ä»»åŠ¡T1
4. éªŒè¯ç”¨æˆ·Bæ— æ³•çœ‹åˆ°æˆ–æ“ä½œT1

**é¢„æœŸç»“æœ**: 
- ç”¨æˆ·Bçš„ä»»åŠ¡åˆ—è¡¨ä¸åŒ…å«T1
- ç›´æ¥è®¿é—®T1çš„APIè¿”å›403é”™è¯¯
- æ•°æ®åº“æŸ¥è¯¢è‡ªåŠ¨è¿‡æ»¤å…¶ä»–ç”¨æˆ·æ•°æ®

**æµ‹è¯•æ•°æ®**:
```json
{
  "userA": {"username": "alice", "password": "test123"},
  "userB": {"username": "bob", "password": "test456"},
  "taskT1": {"title": "Aliceçš„ç§äººä»»åŠ¡", "user_id": "alice_id"}
}
```

### SEC-002: JWTè®¤è¯å®‰å…¨æµ‹è¯•
**æµ‹è¯•ç›®æ ‡**: éªŒè¯JWT tokençš„å®‰å…¨æ€§

**æµ‹è¯•æ­¥éª¤**:
1. ç”¨æˆ·ç™»å½•è·å–JWT token
2. ä½¿ç”¨æœ‰æ•ˆtokenè®¿é—®API
3. ä½¿ç”¨è¿‡æœŸtokenè®¿é—®API
4. ä½¿ç”¨ä¼ªé€ tokenè®¿é—®API
5. ä½¿ç”¨å…¶ä»–ç”¨æˆ·tokenè®¿é—®API

**é¢„æœŸç»“æœ**:
- æœ‰æ•ˆtokenæ­£å¸¸è®¿é—®
- è¿‡æœŸtokenè¿”å›401é”™è¯¯
- ä¼ªé€ tokenè¿”å›401é”™è¯¯
- è·¨ç”¨æˆ·tokenè®¿é—®è¢«æ‹’ç»

### SEC-003: å¯†ç å®‰å…¨æµ‹è¯•
**æµ‹è¯•ç›®æ ‡**: éªŒè¯å¯†ç åŠ å¯†å­˜å‚¨

**æµ‹è¯•æ­¥éª¤**:
1. ç”¨æˆ·æ³¨å†Œæ—¶è¾“å…¥æ˜æ–‡å¯†ç 
2. æ£€æŸ¥æ•°æ®åº“ä¸­å­˜å‚¨çš„å¯†ç 
3. éªŒè¯å¯†ç å“ˆå¸Œç®—æ³•
4. æµ‹è¯•å¯†ç å¼ºåº¦éªŒè¯

**é¢„æœŸç»“æœ**:
- æ•°æ®åº“ä¸­ä¸å­˜å‚¨æ˜æ–‡å¯†ç 
- ä½¿ç”¨bcryptæˆ–ç±»ä¼¼å®‰å…¨ç®—æ³•
- å¯†ç å¼ºåº¦ç¬¦åˆå®‰å…¨è¦æ±‚

## ğŸ“ åŠŸèƒ½æµ‹è¯•ç”¨ä¾‹

### ç”¨æˆ·ç®¡ç†æ¨¡å—æµ‹è¯•

#### FUNC-001: ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½æµ‹è¯•
**å¯¹åº”ç”¨æˆ·æ•…äº‹**: US-001
**å¯¹åº”ä»»åŠ¡**: T-001

**æµ‹è¯•ç”¨ä¾‹**:
1. **æ­£å¸¸æ³¨å†Œ**
   - è¾“å…¥: æœ‰æ•ˆç”¨æˆ·åã€å¯†ç ã€é‚®ç®±
   - é¢„æœŸ: æ³¨å†ŒæˆåŠŸï¼Œè·³è½¬ç™»å½•é¡µ

2. **ç”¨æˆ·åé‡å¤**
   - è¾“å…¥: å·²å­˜åœ¨çš„ç”¨æˆ·å
   - é¢„æœŸ: æ˜¾ç¤º"ç”¨æˆ·åå·²å­˜åœ¨"é”™è¯¯

3. **å¯†ç å¼ºåº¦ä¸è¶³**
   - è¾“å…¥: å¼±å¯†ç 
   - é¢„æœŸ: æ˜¾ç¤ºå¯†ç å¼ºåº¦è¦æ±‚

4. **é‚®ç®±æ ¼å¼é”™è¯¯**
   - è¾“å…¥: æ— æ•ˆé‚®ç®±æ ¼å¼
   - é¢„æœŸ: æ˜¾ç¤ºé‚®ç®±æ ¼å¼é”™è¯¯

#### FUNC-002: ç”¨æˆ·ç™»å½•åŠŸèƒ½æµ‹è¯•
**å¯¹åº”ç”¨æˆ·æ•…äº‹**: US-002
**å¯¹åº”ä»»åŠ¡**: T-002

**æµ‹è¯•ç”¨ä¾‹**:
1. **æ­£å¸¸ç™»å½•**
   - è¾“å…¥: æ­£ç¡®ç”¨æˆ·åå’Œå¯†ç 
   - é¢„æœŸ: ç™»å½•æˆåŠŸï¼Œè·å¾—JWT token

2. **ç”¨æˆ·åé”™è¯¯**
   - è¾“å…¥: ä¸å­˜åœ¨çš„ç”¨æˆ·å
   - é¢„æœŸ: æ˜¾ç¤º"ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"

3. **å¯†ç é”™è¯¯**
   - è¾“å…¥: é”™è¯¯å¯†ç 
   - é¢„æœŸ: æ˜¾ç¤º"ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"

4. **è®°ä½æˆ‘åŠŸèƒ½**
   - è¾“å…¥: å‹¾é€‰"è®°ä½æˆ‘"
   - é¢„æœŸ: tokenæœ‰æ•ˆæœŸå»¶é•¿

### ä»»åŠ¡ç®¡ç†æ¨¡å—æµ‹è¯•

#### FUNC-003: ä»»åŠ¡CRUDæ“ä½œæµ‹è¯•
**å¯¹åº”ç”¨æˆ·æ•…äº‹**: US-004, US-005, US-006, US-007
**å¯¹åº”ä»»åŠ¡**: T-005, T-006

**åˆ›å»ºä»»åŠ¡æµ‹è¯•**:
```javascript
describe('ä»»åŠ¡åˆ›å»º', () => {
  test('åˆ›å»ºå®Œæ•´ä»»åŠ¡', async () => {
    const taskData = {
      title: 'æµ‹è¯•ä»»åŠ¡',
      description: 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•ä»»åŠ¡',
      due_date: '2025-12-31T23:59:59',
      priority: 'high',
      status: 'todo'
    };
    
    const response = await api.post('/tasks', taskData);
    expect(response.status).toBe(201);
    expect(response.data.title).toBe(taskData.title);
  });
  
  test('å¿…å¡«å­—æ®µéªŒè¯', async () => {
    const taskData = { description: 'ç¼ºå°‘æ ‡é¢˜' };
    const response = await api.post('/tasks', taskData);
    expect(response.status).toBe(400);
    expect(response.data.error).toContain('title');
  });
});
```

**æŸ¥è¯¢ä»»åŠ¡æµ‹è¯•**:
```javascript
describe('ä»»åŠ¡æŸ¥è¯¢', () => {
  test('è·å–ç”¨æˆ·ä»»åŠ¡åˆ—è¡¨', async () => {
    const response = await api.get('/tasks');
    expect(response.status).toBe(200);
    expect(Array.isArray(response.data)).toBe(true);
  });
  
  test('ä»»åŠ¡æ’åºåŠŸèƒ½', async () => {
    const response = await api.get('/tasks?sort=due_date&order=asc');
    const tasks = response.data;
    for (let i = 1; i < tasks.length; i++) {
      expect(new Date(tasks[i].due_date) >= new Date(tasks[i-1].due_date)).toBe(true);
    }
  });
});
```

### æé†’ç³»ç»Ÿæµ‹è¯•

#### FUNC-004: æµè§ˆå™¨é€šçŸ¥æµ‹è¯•
**å¯¹åº”ç”¨æˆ·æ•…äº‹**: US-010
**å¯¹åº”ä»»åŠ¡**: T-013

**æµ‹è¯•ç”¨ä¾‹**:
1. **é€šçŸ¥æƒé™è¯·æ±‚**
   - æ“ä½œ: é¦–æ¬¡è®¿é—®ç³»ç»Ÿ
   - é¢„æœŸ: è¯·æ±‚é€šçŸ¥æƒé™

2. **åˆ°æœŸæé†’è§¦å‘**
   - è®¾ç½®: ä»»åŠ¡30åˆ†é’Ÿååˆ°æœŸ
   - é¢„æœŸ: åœ¨åˆ°æœŸå‰30åˆ†é’Ÿæ”¶åˆ°é€šçŸ¥

3. **é€šçŸ¥å†…å®¹éªŒè¯**
   - éªŒè¯: é€šçŸ¥åŒ…å«ä»»åŠ¡æ ‡é¢˜ã€æˆªæ­¢æ—¶é—´
   - é¢„æœŸ: ä¿¡æ¯å®Œæ•´å‡†ç¡®

4. **ç‚¹å‡»é€šçŸ¥è·³è½¬**
   - æ“ä½œ: ç‚¹å‡»é€šçŸ¥
   - é¢„æœŸ: è·³è½¬åˆ°ä»»åŠ¡è¯¦æƒ…é¡µ

## ğŸ­ ç”¨æˆ·ç•Œé¢æµ‹è¯•

### UI-001: å“åº”å¼è®¾è®¡æµ‹è¯•
**å¯¹åº”ç”¨æˆ·æ•…äº‹**: US-014
**å¯¹åº”ä»»åŠ¡**: T-012

**æµ‹è¯•è®¾å¤‡**:
- æ¡Œé¢: 1920x1080, 1366x768
- å¹³æ¿: 768x1024, 1024x768
- æ‰‹æœº: 375x667, 414x896

**æµ‹è¯•å†…å®¹**:
- å¸ƒå±€é€‚é…
- è§¦æ‘¸æ“ä½œ
- å­—ä½“å¤§å°
- æŒ‰é’®å°ºå¯¸

### UI-002: çœ‹æ¿è§†å›¾æµ‹è¯•
**å¯¹åº”ç”¨æˆ·æ•…äº‹**: US-008
**å¯¹åº”ä»»åŠ¡**: T-010

**æ‹–æ‹½åŠŸèƒ½æµ‹è¯•**:
```javascript
describe('çœ‹æ¿æ‹–æ‹½', () => {
  test('ä»»åŠ¡çŠ¶æ€æ‹–æ‹½æ›´æ–°', async () => {
    // æ¨¡æ‹Ÿæ‹–æ‹½æ“ä½œ
    await page.dragAndDrop('[data-task-id="1"]', '[data-status="in_progress"]');
    
    // éªŒè¯çŠ¶æ€æ›´æ–°
    const task = await api.get('/tasks/1');
    expect(task.data.status).toBe('in_progress');
  });
});
```

## âš¡ æ€§èƒ½æµ‹è¯•ç”¨ä¾‹

### PERF-001: APIå“åº”æ—¶é—´æµ‹è¯•
**æ€§èƒ½è¦æ±‚**: APIå“åº”æ—¶é—´ < 200ms

**æµ‹è¯•åœºæ™¯**:
```python
import pytest
import time

def test_api_response_time():
    start_time = time.time()
    response = client.get('/tasks')
    end_time = time.time()
    
    assert response.status_code == 200
    assert (end_time - start_time) < 0.2  # 200ms
```

### PERF-002: å¹¶å‘ç”¨æˆ·æµ‹è¯•
**æ€§èƒ½è¦æ±‚**: æ”¯æŒ50ä¸ªå¹¶å‘ç”¨æˆ·

**è´Ÿè½½æµ‹è¯•è„šæœ¬**:
```python
from locust import HttpUser, task, between

class TaskUser(HttpUser):
    wait_time = between(1, 3)
    
    def on_start(self):
        # ç”¨æˆ·ç™»å½•
        self.client.post('/auth/login', {
            'username': 'testuser',
            'password': 'testpass'
        })
    
    @task(3)
    def view_tasks(self):
        self.client.get('/tasks')
    
    @task(1)
    def create_task(self):
        self.client.post('/tasks', {
            'title': 'Load test task',
            'due_date': '2025-12-31T23:59:59'
        })
```

### PERF-003: æ•°æ®åº“æ€§èƒ½æµ‹è¯•
**æµ‹è¯•ç›®æ ‡**: å¤§é‡æ•°æ®ä¸‹çš„æŸ¥è¯¢æ€§èƒ½

**æµ‹è¯•æ•°æ®**:
- 100ä¸ªç”¨æˆ·
- æ¯ç”¨æˆ·100ä¸ªä»»åŠ¡
- æ€»è®¡10,000ä¸ªä»»åŠ¡

**æµ‹è¯•æŸ¥è¯¢**:
- ç”¨æˆ·ä»»åŠ¡åˆ—è¡¨æŸ¥è¯¢
- ä»»åŠ¡æœç´¢åŠŸèƒ½
- ä»»åŠ¡ç»Ÿè®¡æŸ¥è¯¢

## ğŸ”§ è‡ªåŠ¨åŒ–æµ‹è¯•é…ç½®

### CI/CDé›†æˆ
```yaml
# .github/workflows/test.yml
name: Test Suite
on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Setup Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.9'
      
      - name: Install dependencies
        run: |
          pip install -r requirements.txt
          pip install pytest pytest-cov
      
      - name: Run unit tests
        run: pytest tests/unit --cov=src
      
      - name: Run integration tests
        run: pytest tests/integration
      
      - name: Run E2E tests
        run: pytest tests/e2e
```

### æµ‹è¯•æ•°æ®ç®¡ç†
```python
# conftest.py
import pytest
from sqlalchemy import create_engine
from src.database import Base

@pytest.fixture(scope="session")
def test_db():
    engine = create_engine("sqlite:///test.db")
    Base.metadata.create_all(engine)
    yield engine
    Base.metadata.drop_all(engine)

@pytest.fixture
def sample_user():
    return {
        "username": "testuser",
        "password": "testpass123",
        "email": "test@example.com"
    }
```

## ğŸ“Š æµ‹è¯•è¦†ç›–ç‡è¦æ±‚

### ä»£ç è¦†ç›–ç‡ç›®æ ‡
- **åç«¯ä»£ç **: â‰¥ 85%
- **å‰ç«¯ä»£ç **: â‰¥ 80%
- **å…³é”®ä¸šåŠ¡é€»è¾‘**: 100%
- **å®‰å…¨ç›¸å…³ä»£ç **: 100%

### æµ‹è¯•æŠ¥å‘Š
- **å•å…ƒæµ‹è¯•æŠ¥å‘Š**: pytest-html
- **è¦†ç›–ç‡æŠ¥å‘Š**: coverage.py
- **æ€§èƒ½æµ‹è¯•æŠ¥å‘Š**: locustæŠ¥å‘Š
- **E2Eæµ‹è¯•æŠ¥å‘Š**: PlaywrightæŠ¥å‘Š

## ğŸ¯ æµ‹è¯•æ‰§è¡Œè®¡åˆ’

### ç¬¬1å‘¨: å•å…ƒæµ‹è¯•å¼€å‘
- ç”¨æˆ·ç®¡ç†æ¨¡å—æµ‹è¯•
- ä»»åŠ¡ç®¡ç†æ¨¡å—æµ‹è¯•
- å·¥å…·å‡½æ•°æµ‹è¯•

### ç¬¬2å‘¨: é›†æˆæµ‹è¯•å¼€å‘
- APIæ¥å£æµ‹è¯•
- æ•°æ®åº“é›†æˆæµ‹è¯•
- å‰åç«¯é›†æˆæµ‹è¯•

### ç¬¬3å‘¨: E2Eå’Œæ€§èƒ½æµ‹è¯•
- ç”¨æˆ·æµç¨‹E2Eæµ‹è¯•
- æ€§èƒ½åŸºå‡†æµ‹è¯•
- å®‰å…¨æµ‹è¯•

### ç¬¬4å‘¨: æµ‹è¯•ä¼˜åŒ–å’ŒCI/CD
- æµ‹è¯•ç”¨ä¾‹ä¼˜åŒ–
- CI/CDæµæ°´çº¿é…ç½®
- æµ‹è¯•æŠ¥å‘Šå®Œå–„

## âœ… æµ‹è¯•éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½æµ‹è¯•éªŒæ”¶
- [ ] æ‰€æœ‰ç”¨æˆ·æ•…äº‹æµ‹è¯•é€šè¿‡
- [ ] æ•°æ®éš”ç¦»æµ‹è¯•100%é€šè¿‡
- [ ] å®‰å…¨æµ‹è¯•æ— é«˜å±æ¼æ´
- [ ] æ€§èƒ½æµ‹è¯•è¾¾åˆ°æŒ‡æ ‡è¦æ±‚

### è´¨é‡æŒ‡æ ‡éªŒæ”¶
- [ ] ä»£ç è¦†ç›–ç‡è¾¾åˆ°ç›®æ ‡
- [ ] è‡ªåŠ¨åŒ–æµ‹è¯•é€šè¿‡ç‡ â‰¥ 95%
- [ ] æ€§èƒ½æµ‹è¯•é€šè¿‡ç‡ 100%
- [ ] å®‰å…¨æµ‹è¯•é€šè¿‡ç‡ 100%

## ğŸ”„ ä¸‹ä¸€é˜¶æ®µå‡†å¤‡

**S4é˜¶æ®µè¾“å…¥**:
- å®Œæ•´çš„æµ‹è¯•ç”¨ä¾‹è®¾è®¡
- è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶
- æ€§èƒ½åŸºå‡†å’Œå®‰å…¨è¦æ±‚
- CI/CDæµ‹è¯•æµæ°´çº¿

**S4é˜¶æ®µç›®æ ‡**: åŸºäºæµ‹è¯•ç”¨ä¾‹å¼€å§‹åŠŸèƒ½å®ç°ï¼Œé‡‡ç”¨TDD(æµ‹è¯•é©±åŠ¨å¼€å‘)æ–¹å¼ç¡®ä¿ä»£ç è´¨é‡ã€‚

---
*åŸºäº AceFlow Standard æ¨¡å¼ã€S1ç”¨æˆ·æ•…äº‹å’ŒS2ä»»åŠ¡åˆ†è§£ç”Ÿæˆ*
*ä¸‹ä¸€é˜¶æ®µ: S4_implementation*
